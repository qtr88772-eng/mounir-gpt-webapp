<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>MOUNIR GPT-5.2</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#060812; --bg1:#0a1020; --bg2:#0b1630;
      --glass: rgba(255,255,255,.06);
      --glass2: rgba(255,255,255,.04);
      --stroke: rgba(255,255,255,.10);
      --stroke2: rgba(255,255,255,.14);
      --text: #eaf0ff;
      --muted: rgba(234,240,255,.66);
      --accent: #2dd4bf;
      --accent2:#22c55e;
      --purple:#6366f1;
      --shadow: 0 20px 55px rgba(0,0,0,.58);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Cairo", system-ui, -apple-system, Segoe UI, Arial;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 18% 18%, rgba(45,212,191,.18), transparent 60%),
        radial-gradient(900px 650px at 82% 70%, rgba(99,102,241,.18), transparent 58%),
        radial-gradient(700px 520px at 50% 95%, rgba(34,197,94,.11), transparent 60%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow:hidden;
      padding:18px;
      display:grid;
      place-items:center;
    }
    body:before{
      content:"";
      position:fixed; inset:-20%;
      background:
        radial-gradient(1px 1px at 12% 21%, rgba(255,255,255,.23) 45%, transparent 46%),
        radial-gradient(1px 1px at 30% 80%, rgba(255,255,255,.18) 45%, transparent 46%),
        radial-gradient(1px 1px at 68% 28%, rgba(255,255,255,.20) 45%, transparent 46%),
        radial-gradient(1px 1px at 86% 55%, rgba(255,255,255,.16) 45%, transparent 46%),
        radial-gradient(1px 1px at 55% 48%, rgba(255,255,255,.12) 45%, transparent 46%),
        radial-gradient(1px 1px at 16% 66%, rgba(255,255,255,.10) 45%, transparent 46%),
        radial-gradient(2px 2px at 72% 78%, rgba(45,212,191,.16) 45%, transparent 46%),
        radial-gradient(2px 2px at 42% 58%, rgba(99,102,241,.14) 45%, transparent 46%);
      opacity:.85;
      pointer-events:none;
      filter: blur(.15px);
    }
    .app{
      width:min(1320px, 100%);
      height:min(760px, calc(100vh - 36px));
      border-radius:22px;
      overflow:hidden;
      border:1px solid var(--stroke);
      box-shadow:var(--shadow);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      backdrop-filter: blur(12px);
      display:flex;
      position:relative;
    }
    .sidebar{
      width:340px;
      background: linear-gradient(180deg, rgba(11,16,33,.82), rgba(8,12,26,.72));
      border-left:1px solid rgba(255,255,255,.10);
      padding:18px 16px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .brand{display:flex; align-items:center; gap:12px; padding:8px 8px 10px;}
    .brand .ring{
      width:44px; height:44px; border-radius:16px;
      display:grid; place-items:center;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.14), rgba(255,255,255,.04)),
        linear-gradient(135deg, rgba(45,212,191,.25), rgba(99,102,241,.22));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 12px 28px rgba(0,0,0,.42);
      position:relative;
    }
    .brand .ring:before{
      content:"";
      position:absolute; inset:-2px;
      border-radius:18px;
      background: conic-gradient(from 180deg, rgba(45,212,191,.0), rgba(45,212,191,.45), rgba(99,102,241,.45), rgba(34,197,94,.35), rgba(45,212,191,.0));
      filter: blur(10px);
      opacity:.55;
      z-index:-1;
    }
    .brand .namewrap{line-height:1.1}
    .brand .title{font-weight:700; font-size:20px; letter-spacing:.2px}
    .brand .sub{font-size:13px; color:rgba(45,212,191,.88); margin-top:2px}

    .btn{
      width:100%;
      border:1px solid var(--stroke2);
      background: rgba(255,255,255,.05);
      color:var(--text);
      border-radius:16px;
      padding:12px 14px;
      display:flex; align-items:center; justify-content:center;
      gap:10px;
      font-size:15px;
      cursor:pointer;
      transition: background .15s ease, transform .08s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.08) }
    .btn:active{ transform: scale(.995) }
    .btn.primary{
      background: linear-gradient(90deg, rgba(45,212,191,.35), rgba(99,102,241,.20));
      border-color: rgba(45,212,191,.35);
    }

    .search{
      display:flex; align-items:center; gap:10px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);
      border-radius:16px;
      padding:10px 12px;
    }
    .search input{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color:var(--text);
      font-family:inherit;
      font-size:14px;
    }
    .search input::placeholder{ color: rgba(234,240,255,.45) }

    .list{ flex:1; overflow:auto; padding:4px 2px; }
    .list::-webkit-scrollbar{width:10px}
    .list::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border-radius:10px;
      border:2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    .chatItem{
      display:flex; align-items:center; gap:10px;
      padding:10px 10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      margin-bottom:10px;
      cursor:pointer;
      transition: background .15s ease, border-color .15s ease, transform .08s ease;
      position:relative;
    }
    .chatItem:hover{ background: rgba(255,255,255,.06) }
    .chatItem:active{ transform: scale(.995) }
    .chatItem.active{
      background: linear-gradient(90deg, rgba(45,212,191,.18), rgba(99,102,241,.16));
      border-color: rgba(45,212,191,.30);
      box-shadow: 0 12px 30px rgba(0,0,0,.30);
    }

    .chatIcon{
      width:34px; height:34px; border-radius:14px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      flex:0 0 auto;
    }
    .chatTitle{
      flex:1; min-width:0;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      font-size:14px;
      color: rgba(234,240,255,.92);
    }
    .dots{
      width:34px; height:34px; border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:grid; place-items:center;
      flex:0 0 auto;
      cursor:pointer;
      transition: background .15s ease;
    }
    .dots:hover{ background: rgba(255,255,255,.08) }

    .menu{
      position:absolute;
      top:46px; left:12px;
      width:160px;
      border-radius:16px;
      background: rgba(12,16,34,.92);
      border:1px solid rgba(255,255,255,.12);
      box-shadow: 0 20px 55px rgba(0,0,0,.55);
      padding:8px;
      display:none;
      z-index:10;
    }
    .menu button{
      width:100%;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      color:var(--text);
      font-family:inherit;
      border-radius:12px;
      padding:10px 10px;
      cursor:pointer;
      text-align:right;
      display:flex; align-items:center; justify-content:space-between;
      gap:8px;
      margin-bottom:8px;
    }
    .menu button:last-child{ margin-bottom:0 }
    .menu button:hover{ background: rgba(255,255,255,.07) }
    .menu .danger{ border-color: rgba(248,113,113,.28) }

    .sideFooter{
      display:flex; align-items:center; justify-content:space-between;
      padding-top:12px;
      border-top:1px solid rgba(255,255,255,.08);
      color: rgba(234,240,255,.55);
      font-size:12px;
    }
    .gear{
      width:38px; height:38px; border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:grid; place-items:center;
      cursor:pointer;
    }
    .gear:hover{ background: rgba(255,255,255,.08) }

    .main{ flex:1; display:flex; flex-direction:column; background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); position:relative; }

    .topbar{
      height:72px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 18px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .topLeft{ display:flex; align-items:center; gap:12px; min-width:0; }
    .backBtn{
      width:40px; height:40px; border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:none;
      place-items:center;
      cursor:pointer;
    }
    .backBtn:hover{ background: rgba(255,255,255,.08) }

    .topTitle{
      font-weight:700; font-size:26px; letter-spacing:.2px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      max-width: calc(100vw - 640px);
    }
    .topRight{ display:flex; align-items:center; gap:10px; }

    .modePill{
      display:flex; align-items:center; gap:8px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      cursor:pointer;
      user-select:none;
      font-size:13px;
      color: rgba(234,240,255,.86);
      transition: background .15s ease, border-color .15s ease;
    }
    .modePill.on{
      border-color: rgba(45,212,191,.35);
      background: rgba(45,212,191,.10);
    }

    .topIcon{
      width:44px; height:44px; border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      display:grid; place-items:center;
      cursor:pointer;
      transition: background .15s ease;
    }
    .topIcon:hover{ background: rgba(255,255,255,.08) }

    .chat{ flex:1; overflow:auto; padding:18px 22px 10px; }
    .chat::-webkit-scrollbar{width:10px}
    .chat::-webkit-scrollbar-thumb{
      background: rgba(255,255,255,.10);
      border-radius:10px;
      border:2px solid rgba(0,0,0,0);
      background-clip: padding-box;
    }

    .row{ display:flex; margin:12px 0; }
    .row.user{ justify-content:flex-end }
    .row.assistant{ justify-content:flex-start }

    .bubble{
      max-width:78%;
      padding:14px 16px;
      border-radius:20px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      line-height:1.9;
      white-space:pre-wrap;
      word-break:break-word;
    }
    .row.user .bubble{
      background: rgba(255,255,255,.08);
      border-color: rgba(255,255,255,.12);
    }

    .assistantCard{
      display:flex; align-items:flex-start; gap:12px;
      padding:14px 14px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
      max-width:86%;
      position:relative;
    }
    .avatar{
      width:44px; height:44px; border-radius:18px;
      background:
        radial-gradient(circle at 30% 20%, rgba(255,255,255,.14), rgba(255,255,255,.03)),
        linear-gradient(135deg, rgba(45,212,191,.30), rgba(99,102,241,.22));
      border:1px solid rgba(255,255,255,.14);
      box-shadow: 0 14px 30px rgba(0,0,0,.35);
      display:grid; place-items:center;
      flex:0 0 auto;
      position:relative;
    }
    .avatar:before{
      content:"";
      position:absolute; inset:-2px;
      border-radius:20px;
      background: conic-gradient(from 180deg, rgba(45,212,191,.0), rgba(45,212,191,.52), rgba(99,102,241,.50), rgba(34,197,94,.34), rgba(45,212,191,.0));
      filter: blur(10px);
      opacity:.6;
      z-index:-1;
    }
    .meta{ display:flex; flex-direction:column; gap:2px; min-width:0; flex:1; }
    .metaTop{ display:flex; align-items:center; gap:10px; min-width:0; }
    .metaTop .who{ font-weight:700; font-size:18px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .metaTop .model{
      font-size:12px;
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(234,240,255,.76);
      flex:0 0 auto;
      direction:ltr;
    }
    .metaText{
      color: rgba(234,240,255,.92);
      line-height:1.9;
      white-space:pre-wrap;
      word-break:break-word;
    }

    .composer{
      padding:14px 18px 16px;
      border-top:1px solid rgba(255,255,255,.08);
      background: linear-gradient(180deg, rgba(0,0,0,0), rgba(0,0,0,.05));
    }
    .bar{
      display:flex; align-items:center; gap:12px;
      padding:12px 12px;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(10,14,25,.52);
      box-shadow: 0 16px 38px rgba(0,0,0,.42);
    }
    .tool{
      width:46px; height:46px; border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      display:grid; place-items:center;
      cursor:pointer;
      transition: background .15s ease, transform .08s ease;
      flex:0 0 auto;
    }
    .tool:hover{ background: rgba(255,255,255,.08) }
    .tool:active{ transform: scale(.995) }

    .inputWrap{
      flex:1;
      height:46px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.03);
      display:flex; align-items:center;
      padding:0 12px;
      gap:10px;
    }
    .inputWrap input{
      width:100%;
      border:none; outline:none;
      background:transparent;
      color:var(--text);
      font-family:inherit;
      font-size:15px;
    }
    .inputWrap input::placeholder{ color: rgba(234,240,255,.42) }

    .send{
      width:60px; height:46px;
      border:none;
      border-radius:18px;
      cursor:pointer;
      display:grid; place-items:center;
      color:#071b16;
      background: linear-gradient(90deg, rgba(45,212,191,.92), rgba(34,197,94,.86));
      box-shadow: 0 16px 40px rgba(45,212,191,.10);
      transition: filter .15s ease, transform .08s ease;
    }
    .send:hover{ filter: brightness(1.04) }
    .send:active{ transform: scale(.995) }
    .send[disabled]{ opacity:.6; cursor:not-allowed }

    .pending{ display:none; padding-top:10px; justify-content:center; gap:10px; }
    .chip{
      display:flex; align-items:center; gap:8px;
      padding:7px 12px;
      border-radius:999px;
      border:1px solid rgba(45,212,191,.24);
      background: rgba(45,212,191,.10);
      font-size:12px;
      color: rgba(234,240,255,.85);
      user-select:none;
    }
    .chip .x{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      border-radius:12px;
      padding:0 6px;
      font-weight:700;
    }
    .chip .x:hover{ background: rgba(255,255,255,.10) }

    /* ===== Download Cards (Auto) ===== */
    .filesWrap{ margin-top:10px; display:flex; flex-direction:column; gap:10px; }
    .fileCard{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:12px 12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      box-shadow: 0 12px 26px rgba(0,0,0,.22);
    }
    .fileLeft{ display:flex; flex-direction:column; gap:2px; min-width:0; flex:1; }
    .fileCardName{
      font-weight:700;
      font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .fileCardUrl{
      font-size:12px;
      color: rgba(234,240,255,.55);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
      direction:ltr;
      text-align:left;
    }
    .dlBtn{
      flex:0 0 auto;
      text-decoration:none;
      border:1px solid rgba(45,212,191,.30);
      background: rgba(45,212,191,.12);
      color: rgba(234,240,255,.92);
      border-radius:14px;
      padding:10px 12px;
      font-size:13px;
      transition: background .15s ease, transform .08s ease, filter .15s ease;
    }
    .dlBtn:hover{ background: rgba(45,212,191,.18); filter: brightness(1.02) }
    .dlBtn:active{ transform: scale(.995) }

    /* ===== Modal ===== */
    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.45);
      display:none; align-items:center; justify-content:center;
      z-index:50;
    }
    .modal{
      width:min(760px, calc(100vw - 22px));
      max-height:min(640px, calc(100vh - 22px));
      overflow:auto;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(12,16,34,.92);
      box-shadow: 0 24px 70px rgba(0,0,0,.60);
      padding:16px;
    }
    .modal h3{ margin:0 0 12px; font-size:18px }
    .close{
      float:left;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:8px 10px;
      cursor:pointer;
    }
    .fileRow{
      display:flex; align-items:center; gap:10px;
      padding:10px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      margin-bottom:10px;
    }
    .fileName{ flex:1; min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
    .tag{
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: rgba(234,240,255,.78);
    }
    .mini{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      color:var(--text);
      border-radius:14px;
      padding:8px 10px;
      cursor:pointer;
      font-family:inherit;
      font-size:13px;
    }
    .mini:hover{ background: rgba(255,255,255,.08) }
    .mini.primary{ border-color: rgba(45,212,191,.30); background: rgba(45,212,191,.12) }

    @media (max-width: 860px){
      body{ padding:10px }
      .sidebar{ position:absolute; inset:0 auto 0 0; width:86%; max-width:360px; transform: translateX(-110%); transition: transform .18s ease; z-index:30; }
      .sidebar.open{ transform: translateX(0) }
      .backBtn{ display:grid }
      .topTitle{ max-width: calc(100vw - 320px) }
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="ring" aria-hidden="true">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
            <path d="M12 2c3 0 5.5 2.5 5.5 5.5 0 1.2-.4 2.3-1.1 3.2" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
            <path d="M21.8 12c0 3-2.5 5.5-5.5 5.5-1.2 0-2.3-.4-3.2-1.1" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
            <path d="M12 22c-3 0-5.5-2.5-5.5-5.5 0-1.2.4-2.3 1.1-3.2" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
            <path d="M2.2 12c0-3 2.5-5.5 5.5-5.5 1.2 0 2.3.4 3.2 1.1" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="namewrap">
          <div class="title">MOUNIR</div>
          <div class="sub">GPT-5.2</div>
        </div>
      </div>

      <button class="btn primary" id="newChatBtn">
        <span style="font-size:18px">Ôºã</span>
        <span>ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ©</span>
      </button>

      <div class="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="rgba(234,240,255,.70)" stroke-width="2"/>
          <path d="M21 21l-4.2-4.2" stroke="rgba(234,240,255,.55)" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="searchInput" placeholder="ÿ®ÿ≠ÿ´ ŸÅŸä ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™..." />
      </div>

      <div class="list" id="chatList"></div>

      <div class="sideFooter">
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="opacity:.85">OpenRouter</span>
          <span style="opacity:.55">‚Ä¢</span>
          <span id="statusText" style="opacity:.70">ÿ¨ÿßŸáÿ≤</span>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
          <button class="gear" id="filesBtn" title="ÿßŸÑŸÖŸÑŸÅÿßÿ™">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M14 3H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9" stroke="rgba(234,240,255,.80)" stroke-width="2" stroke-linecap="round"/>
              <path d="M14 3v6h6" stroke="rgba(234,240,255,.80)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>
          <button class="gear" id="settingsBtn" title="ÿ•ÿπÿØÿßÿØÿßÿ™">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="rgba(234,240,255,.80)" stroke-width="2"/>
              <path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-1.2-2-3.5-2.3.7a8 8 0 0 0-5.2-3L11.7 0h-3.4L8 2a8 8 0 0 0-5.2 3L.5 4.3l-2 3.5 2 1.2a7.8 7.8 0 0 0 .1 6l-2 1.2 2 3.5 2.3-.7a8 8 0 0 0 5.2 3L8.3 24h3.4l.3-2a8 8 0 0 0 5.2-3l2.3.7 2-3.5-2-1.2Z" stroke="rgba(234,240,255,.55)" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <div class="topbar">
        <div class="topLeft">
          <button class="backBtn" id="toggleSidebar" title="ÿßŸÑŸÇÿßÿ¶ŸÖÿ©">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M15 18l-6-6 6-6" stroke="rgba(234,240,255,.85)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <div class="topTitle" id="chatTitle">ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ</div>
        </div>

        <div class="topRight">
          <div class="modePill" id="strongModeBtn" title="ÿ™ÿ¥ÿ∫ŸäŸÑ/ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÇŸàŸä">
            <span id="modeDot" style="width:10px;height:10px;border-radius:999px;background:rgba(234,240,255,.35);display:inline-block;"></span>
            <span id="modeText">Ÿàÿ∂ÿπ ŸÇŸàŸä: OFF</span>
          </div>

          <button class="topIcon" id="refreshBtn" title="ÿ™ÿ≠ÿØŸäÿ´">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M21 12a9 9 0 1 1-2.6-6.4" stroke="rgba(234,240,255,.75)" stroke-width="2" stroke-linecap="round"/>
              <path d="M21 3v6h-6" stroke="rgba(234,240,255,.75)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>

          <button class="topIcon" id="infoBtn" title="ŸÖÿπŸÑŸàŸÖÿßÿ™">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="rgba(234,240,255,.75)" stroke-width="2"/>
              <path d="M12 10v6" stroke="rgba(234,240,255,.75)" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 7h.01" stroke="rgba(234,240,255,.75)" stroke-width="3" stroke-linecap="round"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="chat" id="chat"></div>

      <div class="composer">
        <div class="bar">
          <button class="tool" id="plusBtn" title="ÿ±ŸÅÿπ ÿµŸàÿ±/ŸÖŸÑŸÅÿßÿ™">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M12 5v14" stroke="rgba(234,240,255,.85)" stroke-width="2" stroke-linecap="round"/>
              <path d="M5 12h14" stroke="rgba(234,240,255,.85)" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </button>

          <button class="tool" id="attachBtn" title="ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿßŸÑŸÖÿ±ŸÅŸàÿπÿ©">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M21.4 11.1 12 20.5a6 6 0 0 1-8.5-8.5l9.4-9.4a4 4 0 0 1 5.7 5.7l-9.4 9.4a2 2 0 0 1-2.8-2.8l8.7-8.7" stroke="rgba(234,240,255,.75)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>

          <div class="inputWrap">
            <input id="textInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©..." autocomplete="off" />
          </div>

          <button class="send" id="sendBtn" title="ÿ•ÿ±ÿ≥ÿßŸÑ">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
              <path d="M4 12l16-8-6 16-2.5-6L4 12Z" fill="rgba(6,27,22,.95)"/>
            </svg>
          </button>

          <input type="file" id="fileInput" hidden multiple accept="image/*,.pdf,.txt,.doc,.docx" />
        </div>

        <div class="pending" id="pendingRow"></div>
      </div>
    </main>
  </div>

  <!-- Files Modal -->
  <div class="modalBack" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true">
      <button class="close" id="closeModal">ÿ•ÿ∫ŸÑÿßŸÇ</button>
      <h3>ÿßŸÑŸÖŸÑŸÅÿßÿ™</h3>
      <div id="filesList"></div>
    </div>
  </div>

  <script>
    const STORAGE_KEY = "mounir_active_conversation";
    const STRONG_KEY = "mounir_strong_mode";
    let conversationId = localStorage.getItem(STORAGE_KEY) || null;
    let strongMode = localStorage.getItem(STRONG_KEY) === "1";

    let titleMap = {};
    let allChats = [];
    let busy = false;

    let pendingImages = [];

    const sidebar = document.getElementById("sidebar");
    const chatList = document.getElementById("chatList");
    const chatEl = document.getElementById("chat");
    const chatTitleEl = document.getElementById("chatTitle");
    const statusText = document.getElementById("statusText");

    const newChatBtn = document.getElementById("newChatBtn");
    const searchInput = document.getElementById("searchInput");

    const plusBtn = document.getElementById("plusBtn");
    const attachBtn = document.getElementById("attachBtn");
    const fileInput = document.getElementById("fileInput");

    const textInput = document.getElementById("textInput");
    const sendBtn = document.getElementById("sendBtn");
    const pendingRow = document.getElementById("pendingRow");

    const toggleSidebarBtn = document.getElementById("toggleSidebar");
    const refreshBtn = document.getElementById("refreshBtn");
    const infoBtn = document.getElementById("infoBtn");

    const filesBtn = document.getElementById("filesBtn");
    const settingsBtn = document.getElementById("settingsBtn");

    const modalBack = document.getElementById("modalBack");
    const closeModal = document.getElementById("closeModal");
    const filesList = document.getElementById("filesList");

    const strongModeBtn = document.getElementById("strongModeBtn");
    const modeText = document.getElementById("modeText");
    const modeDot = document.getElementById("modeDot");

    function setStrongMode(on){
      strongMode = !!on;
      localStorage.setItem(STRONG_KEY, strongMode ? "1" : "0");
      if(strongMode){
        strongModeBtn.classList.add("on");
        modeText.textContent = "Ÿàÿ∂ÿπ ŸÇŸàŸä: ON";
        modeDot.style.background = "rgba(45,212,191,.85)";
      }else{
        strongModeBtn.classList.remove("on");
        modeText.textContent = "Ÿàÿ∂ÿπ ŸÇŸàŸä: OFF";
        modeDot.style.background = "rgba(234,240,255,.35)";
      }
    }
    setStrongMode(strongMode);

    function setBusy(v){
      busy = v;
      sendBtn.disabled = v;
      textInput.disabled = v;
      statusText.textContent = v ? "ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ±ÿØ..." : "ÿ¨ÿßŸáÿ≤";
      if(!v) setTimeout(()=> textInput.focus(), 0);
    }

    function setTitle(t){
      chatTitleEl.textContent = (t && String(t).trim()) ? t : "ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ";
    }

    function setActiveConversation(id){
      conversationId = id || null;
      if(conversationId) localStorage.setItem(STORAGE_KEY, conversationId);
      else localStorage.removeItem(STORAGE_KEY);

      [...document.querySelectorAll(".chatItem")].forEach(el=>{
        el.classList.toggle("active", el.dataset.id === conversationId);
      });

      setTitle(conversationId ? (titleMap[conversationId] || "ÿßŸÑÿØÿ±ÿØÿ¥ÿ©") : "ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ");
    }

    function scrollBottom(){ chatEl.scrollTop = chatEl.scrollHeight; }

    function friendlyModel(modelId){
      if(!modelId) return "‚Äî";
      const m = String(modelId);
      if(m.includes("gpt-5.2")) return "GPT-5.2";
      if(m.includes("4o-mini")) return "4o-mini";
      if(m === "vision") return "Vision";
      if(m === "upload") return "Upload";
      const last = m.split("/").pop();
      return last || m;
    }

    function addUserMsg(text){
      const row = document.createElement("div");
      row.className = "row user";
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;
      row.appendChild(bubble);
      chatEl.appendChild(row);
      scrollBottom();
    }

    function _trimPunct(s){ return (s || "").replace(/[)\]\}>"'ÿåÿõ:!?ÿü.]+$/g, ""); }
    function _guessName(url){
      try{
        const u = url.startsWith("http") ? new URL(url) : new URL(url, window.location.origin);
        const parts = u.pathname.split("/").filter(Boolean);
        const last = parts[parts.length-1] || "file";
        return decodeURIComponent(last);
      }catch{
        const parts = url.split("/").filter(Boolean);
        return parts[parts.length-1] || "file";
      }
    }
    function extractDownloadLinks(text){
      const out = [];
      if(!text) return out;
      const re = /(https?:\/\/[^\s<>"']+)?\/download\/[^\s<>"']+/g;
      const found = text.match(re) || [];
      const seen = new Set();
      found.forEach(raw=>{
        const u = _trimPunct(raw);
        if(!u || seen.has(u)) return;
        seen.add(u);
        out.push({ url: u, name: _guessName(u) });
      });
      return out;
    }
    function renderAssistantContent(container, text){
      container.innerHTML = "";
      const body = document.createElement("div");
      body.style.whiteSpace = "pre-wrap";
      body.style.wordBreak = "break-word";
      body.textContent = text || "";
      container.appendChild(body);

      const links = extractDownloadLinks(text || "");
      if(links.length){
        const wrap = document.createElement("div");
        wrap.className = "filesWrap";
        links.forEach(l=>{
          const card = document.createElement("div");
          card.className = "fileCard";

          const left = document.createElement("div");
          left.className = "fileLeft";

          const nm = document.createElement("div");
          nm.className = "fileCardName";
          nm.textContent = "üìé " + (l.name || "ŸÖŸÑŸÅ");

          const url = document.createElement("div");
          url.className = "fileCardUrl";
          url.textContent = l.url;

          left.appendChild(nm);
          left.appendChild(url);

          const a = document.createElement("a");
          a.className = "dlBtn";
          a.href = l.url;
          a.target = "_blank";
          a.rel = "noopener";
          a.textContent = "ÿ™ÿ≠ŸÖŸäŸÑ ‚¨áÔ∏è";

          card.appendChild(left);
          card.appendChild(a);
          wrap.appendChild(card);
        });
        container.appendChild(wrap);
      }
    }

    function addAssistantMsg(text, modelId){
      const row = document.createElement("div");
      row.className = "row assistant";
      const card = document.createElement("div");
      card.className = "assistantCard";

      const avatar = document.createElement("div");
      avatar.className = "avatar";
      avatar.innerHTML = `
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
          <path d="M12 3c3.3 0 6 2.7 6 6 0 1.3-.4 2.5-1.1 3.5" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
          <path d="M21 12c0 3.3-2.7 6-6 6-1.3 0-2.5-.4-3.5-1.1" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
          <path d="M12 21c-3.3 0-6-2.7-6-6 0-1.3.4-2.5 1.1-3.5" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
          <path d="M3 12c0-3.3 2.7-6 6-6 1.3 0 2.5.4 3.5 1.1" stroke="rgba(234,240,255,.86)" stroke-width="2" stroke-linecap="round"/>
        </svg>
      `;

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.innerHTML = `
        <div class="metaTop">
          <div class="who">ŸÖŸÜŸäÿ±</div>
          <div class="model"></div>
        </div>
        <div class="metaText"></div>
      `;

      const modelEl = meta.querySelector(".model");
      const textEl = meta.querySelector(".metaText");

      const api = {
        setText: (t)=>renderAssistantContent(textEl, t),
        setModel: (m)=>{ modelEl.textContent = friendlyModel(m); }
      };

      api.setModel(modelId);
      api.setText(text);

      card.appendChild(avatar);
      card.appendChild(meta);
      row.appendChild(card);
      chatEl.appendChild(row);
      scrollBottom();

      return api;
    }

    function clearChat(){ chatEl.innerHTML = ""; }

    function renderChats(){
      const q = (searchInput.value || "").trim();
      const filtered = q
        ? allChats.filter(c => (c.title || "").includes(q) || (c.id || "").includes(q))
        : allChats;

      chatList.innerHTML = "";
      filtered.forEach(c => {
        const item = document.createElement("div");
        item.className = "chatItem";
        item.dataset.id = c.id;

        const icon = document.createElement("div");
        icon.className = "chatIcon";
        icon.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8Z" stroke="rgba(234,240,255,.78)" stroke-width="2" stroke-linejoin="round"/>
          </svg>
        `;

        const title = document.createElement("div");
        title.className = "chatTitle";
        title.textContent = c.title || "New chat";

        const dots = document.createElement("button");
        dots.className = "dots";
        dots.title = "ÿÆŸäÿßÿ±ÿßÿ™";
        dots.innerHTML = `
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
            <path d="M5 12h.01M12 12h.01M19 12h.01" stroke="rgba(234,240,255,.85)" stroke-width="3" stroke-linecap="round"/>
          </svg>
        `;

        const menu = document.createElement("div");
        menu.className = "menu";
        menu.innerHTML = `
          <button data-act="rename">
            <span>ÿ•ÿπÿßÿØÿ© ÿ™ÿ≥ŸÖŸäÿ©</span>
            <span style="opacity:.7">‚úé</span>
          </button>
          <button class="danger" data-act="delete">
            <span>ÿ≠ÿ∞ŸÅ</span>
            <span style="opacity:.7">üóë</span>
          </button>
        `;

        function closeAllMenus(){
          document.querySelectorAll(".menu").forEach(m => m.style.display = "none");
        }

        dots.onclick = (e) => {
          e.stopPropagation();
          const open = menu.style.display === "block";
          closeAllMenus();
          menu.style.display = open ? "none" : "block";
        };

        menu.onclick = async (e) => {
          e.stopPropagation();
          const btn = e.target.closest("button");
          if(!btn) return;
          const act = btn.getAttribute("data-act");
          menu.style.display = "none";

          if(act === "delete"){
            await fetch(`/conversations/${c.id}`, { method:"DELETE" });
            if(conversationId === c.id){
              setActiveConversation(null);
              clearChat();
            }
            await loadChats();
            return;
          }

          if(act === "rename"){
            const t = prompt("ÿßÿ≥ŸÖ ÿßŸÑÿ¥ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØ:", c.title || "");
            if(!t) return;
            const rr = await fetch(`/conversations/${c.id}/title`, {
              method:"POST",
              headers:{ "Content-Type":"application/json" },
              body: JSON.stringify({ title: t })
            });
            if(rr.ok) await loadChats();
            return;
          }
        };

        item.onclick = async () => {
          closeAllMenus();
          await openChat(c.id);
          if(window.matchMedia("(max-width: 860px)").matches){
            sidebar.classList.remove("open");
          }
        };

        item.appendChild(icon);
        item.appendChild(title);
        item.appendChild(dots);
        item.appendChild(menu);
        chatList.appendChild(item);

        if(conversationId === c.id) item.classList.add("active");
      });

      document.addEventListener("click", () => {
        document.querySelectorAll(".menu").forEach(m => m.style.display = "none");
      }, { once: true });
    }

    async function loadChats(){
      const r = await fetch("/conversations");
      if(!r.ok) return;
      allChats = await r.json();
      titleMap = {};
      allChats.forEach(x => titleMap[x.id] = x.title || x.id);
      renderChats();

      if(conversationId && titleMap[conversationId]) setTitle(titleMap[conversationId]);
      else setTitle("ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ");
    }

    async function openChat(id){
      setActiveConversation(id);
      clearChat();
      const r = await fetch(`/conversations/${id}`);
      if(!r.ok) return;
      const msgs = await r.json();
      msgs.forEach(m => {
        if(m.role === "user") addUserMsg(m.content);
        else addAssistantMsg(m.content, m.model);
      });
    }

    function renderPending(){
      const n = pendingImages.length;
      if(!n){
        pendingRow.style.display = "none";
        pendingRow.innerHTML = "";
        return;
      }
      pendingRow.style.display = "flex";
      pendingRow.innerHTML = "";
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.innerHTML = `üì∑ ${n} ÿµŸàÿ±ÿ© ÿ¨ÿßŸáÿ≤ÿ© ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑ <span class="x" title="ÿ•ŸÑÿ∫ÿßÿ°">√ó</span>`;
      chip.querySelector(".x").onclick = () => {
        pendingImages = [];
        renderPending();
      };
      pendingRow.appendChild(chip);
    }

    plusBtn.onclick = () => fileInput.click();
    fileInput.onchange = async () => {
      const files = [...fileInput.files];
      if(!files.length) return;

      const imgs = files.filter(f => (f.type||"").startsWith("image/"));
      const others = files.filter(f => !(f.type||"").startsWith("image/"));

      if(imgs.length){
        pendingImages.push(...imgs);
        renderPending();
        addAssistantMsg(`üì∑ ÿ™ŸÖ ÿ™ÿ¨ŸáŸäÿ≤ ${imgs.length} ÿµŸàÿ±ÿ©. ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ Ÿàÿßÿ∂ÿ∫ÿ∑ ÿ•ÿ±ÿ≥ÿßŸÑ.`, "vision");
      }

      if(others.length){
        const fd = new FormData();
        others.forEach(f => fd.append("files", f));
        try{
          const r = await fetch("/upload", { method:"POST", body: fd });
          if(r.ok) addAssistantMsg("üìé ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ ÿ®ŸÜÿ¨ÿßÿ≠. ÿ™ŸÇÿØÿ± ÿ™ŸÅÿ™ÿ≠ 'ÿßŸÑŸÖŸÑŸÅÿßÿ™' ŸÖŸÜ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä.", "upload");
          else addAssistantMsg("ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™.", "upload");
        }catch{
          addAssistantMsg("ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ£ÿ´ŸÜÿßÿ° ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™.", "upload");
        }
      }

      fileInput.value = "";
      setTimeout(()=> textInput.focus(), 0);
    };

    async function sendTextOnly(msg){
      const r = await fetch("/chat", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({
          conversation_id: conversationId,
          strong: !!strongMode,
          messages: [{ role:"user", content: msg }]
        })
      });
      const data = await r.json().catch(()=> ({}));
      return { ok: r.ok, data };
    }

    async function sendWithImages(prompt){
      const fd = new FormData();
      fd.append("conversation_id", conversationId || "");
      fd.append("prompt", prompt || "");
      pendingImages.forEach(img => fd.append("images", img));
      const r = await fetch("/chat/vision", { method:"POST", body: fd });
      const data = await r.json().catch(()=> ({}));
      return { ok: r.ok, data };
    }

    async function send(){
      if(busy) return;
      const msg = (textInput.value || "").trim();
      if(!msg && pendingImages.length === 0) return;

      textInput.value = "";
      addUserMsg(msg || "üì∑ (ÿ≥ÿ§ÿßŸÑ ÿπŸÑŸâ ÿßŸÑÿµŸàÿ±)");

      const expectedModel = pendingImages.length > 0 ? "vision" : (strongMode ? "openai/gpt-5.2-chat" : "openai/gpt-4o-mini");
      const assistant = addAssistantMsg("‚Ä¶", expectedModel);

      setBusy(true);

      try{
        let result;
        if(pendingImages.length > 0){
          result = await sendWithImages(msg);
          pendingImages = [];
          renderPending();
        }else{
          result = await sendTextOnly(msg);
        }

        if(!result.ok){
          assistant.setText(result.data?.error || "ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£");
          assistant.setModel(result.data?.model || expectedModel);
        }else{
          setActiveConversation(result.data.conversation_id);
          assistant.setText(result.data.reply || "");
          assistant.setModel(result.data.model || expectedModel);

          await loadChats();
          setTitle(titleMap[conversationId] || "ÿßŸÑÿØÿ±ÿØÿ¥ÿ©");
        }
      }catch(e){
        assistant.setText("ÿ≠ÿµŸÑ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±");
      }finally{
        setBusy(false);
      }
    }

    sendBtn.onclick = send;
    textInput.onkeydown = (e) => {
      if(e.key === "Enter"){
        e.preventDefault();
        send();
      }
    };

    document.querySelector(".composer").addEventListener("click", () => {
      if(!busy) textInput.focus();
    });

    newChatBtn.onclick = () => {
      setActiveConversation(null);
      clearChat();
      setTitle("ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ");
      if(window.matchMedia("(max-width: 860px)").matches){
        sidebar.classList.remove("open");
      }
      setTimeout(()=> textInput.focus(), 0);
    };

    toggleSidebarBtn.onclick = () => { sidebar.classList.toggle("open"); };

    strongModeBtn.onclick = () => { setStrongMode(!strongMode); };

    refreshBtn.onclick = async () => {
      await loadChats();
      if(conversationId) await openChat(conversationId);
    };

    infoBtn.onclick = async () => {
      try{
        const r = await fetch("/health");
        const d = await r.json();
        alert(`‚úÖ ${d.app}\nDefault: ${d.default_model}\nStrong: ${d.strong_model}\nVision: ${d.vision_model}\nMax tokens: ${d.max_tokens}`);
      }catch{
        alert("ŸÖÿ¥ ŸÇÿßÿØÿ± ÿ£ÿ¨Ÿäÿ® ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿØŸÑŸàŸÇÿ™Ÿä");
      }
    };

    searchInput.oninput = renderChats;

    function openModal(){ modalBack.style.display = "flex"; }
    function closeModalFn(){ modalBack.style.display = "none"; }
    closeModal.onclick = closeModalFn;
    modalBack.onclick = (e)=>{ if(e.target === modalBack) closeModalFn(); };

    function bytesToSize(bytes){
      const sizes = ["B","KB","MB","GB"];
      if(bytes === 0) return "0 B";
      const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)), 10);
      return (bytes / Math.pow(1024, i)).toFixed(1) + " " + sizes[i];
    }

    function mkBtn(text, cls, onClick){
      const b = document.createElement("button");
      b.className = "mini " + (cls||"");
      b.textContent = text;
      b.onclick = onClick;
      return b;
    }

    async function refreshFiles(){
      filesList.innerHTML = "";
      const r = await fetch("/files");
      if(!r.ok){
        filesList.innerHTML = "<div style='color:rgba(234,240,255,.6)'>ŸÖÿ¥ ŸÇÿßÿØÿ± ÿ£ÿ¨Ÿäÿ® ÿßŸÑŸÖŸÑŸÅÿßÿ™</div>";
        return;
      }
      const items = await r.json();
      if(!items.length){
        filesList.innerHTML = "<div style='color:rgba(234,240,255,.6)'>ŸÖŸÅŸäÿ¥ ŸÖŸÑŸÅÿßÿ™ ŸÖÿ±ŸÅŸàÿπÿ© ŸÑÿ≥Ÿá</div>";
        return;
      }

      items.forEach(f=>{
        const row = document.createElement("div");
        row.className = "fileRow";

        const name = document.createElement("div");
        name.className = "fileName";
        name.textContent = f.name;

        const tag = document.createElement("div");
        tag.className = "tag";
        tag.textContent = `${f.kind} ‚Ä¢ ${bytesToSize(f.size)}`;

        const dl = mkBtn("ÿ™ÿ≠ŸÖŸäŸÑ", "primary", ()=> window.open(f.url, "_blank"));
        row.appendChild(name);
        row.appendChild(tag);
        row.appendChild(dl);

        filesList.appendChild(row);
      });
    }

    filesBtn.onclick = async () => { openModal(); await refreshFiles(); };
    attachBtn.onclick = async () => { openModal(); await refreshFiles(); };
    settingsBtn.onclick = () => alert("ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ Ÿáÿ™ÿ™ÿ∏ÿ®ÿ∑ ŸÇÿ±Ÿäÿ®Ÿãÿß ‚ú®");

    (async function init(){
      await loadChats();
      if(conversationId && titleMap[conversationId]){
        await openChat(conversationId);
      }else{
        setTitle("ÿ¥ÿßÿ™ ÿ¨ÿØŸäÿØ");
      }
      setTimeout(()=> textInput.focus(), 0);
    })();
  </script>
</body>
</html>
